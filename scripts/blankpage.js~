chrome.runtime.onMessage.addListener(
  function(request, sender, sendResponse) {
    if(request.action == "setBackground") {
	
	var data=request.information;
	
	processTextAnalyzerResponse(data,"da");
}
  });




/**
     * This function will process the text analysis server response and render sentence information
     * @param {type} response
     * @param {type} selectedElement
     * @returns {undefined}
     */
    function processTextAnalyzerResponse(response, selectedElement) {

        //var selectedText = $(selectedElement).text();


        var sentenceData = "";
        //var jsonResponse = JSON.parse(response);
        var html = "<div id='tooltipdiv' class='tooltipdiv'>";

        var wordTemplate = "";


        var sentenceMap = response.sentenceMap;

        for (var sentenceIndex = 0; sentenceIndex < sentenceMap.length; sentenceIndex++) {

            var sentenceObject = sentenceMap[sentenceIndex].value;
            var sentenceType = sentenceObject.type;
            var wordInformation = sentenceObject.wordInformation;
            var string = sentenceObject.sentence;
            var verbs = wordInformation.verbs;
            var nouns = wordInformation.nouns;
            var adverbs = wordInformation.adverbs;
            var adjectives = wordInformation.adjectives;


            var sentence_template = "<span style='color:green' <font size='6'><b> Sentence</b> :" + string + "</font></span><br> ";
            sentence_template += "<span style='color:DarkBlue' <font size='5'><b> Type </b>: " + sentenceType + "</font></span><br>";

            if ((typeof verbs != 'undefined') && verbs.length > 0) {
                sentence_template += "<span style='color:Crimson'><b>Verbs:</b> </span><br>";
                sentence_template += "<div style='margin-left: 2em;'>";

                for (var i = 0; i < verbs.length; i++) {
                    var verb = verbs[i];

                    wordTemplate = createWordTemplate(verb);

                    //var word_html = Mustache.to_html(wordTemplate, verb);
                    sentence_template += wordTemplate;
                }
                sentence_template += "</div>";
            }

            if ((typeof nouns != 'undefined') && nouns.length > 0) {
                sentence_template += "<span style='color:Crimson'><b>Nouns:</b> </span><br>";
                sentence_template += "<div style='margin-left: 2em;'>";

                for (var i = 0; i < nouns.length; i++) {
                    var noun = nouns[i];
                    wordTemplate = createWordTemplate(noun);
                    sentence_template += wordTemplate;
                }
                sentence_template += "</div>";
            }

            if ((typeof adjectives != 'undefined') && adjectives.length > 0) {
                sentence_template += "<span style='color:Crimson'><b>Adjectives:</b> </span><br>";
                sentence_template += "<div style='margin-left: 2em;'>";

                for (var i = 0; i < adjectives.length; i++) {
                    var adjective = adjectives[i];
                    wordTemplate = createWordTemplate(adjective);
                    sentence_template += wordTemplate;
                }
                sentence_template += "</div>";
            }

            if ((typeof adverbs != 'undefined') && adverbs.length > 0) {
                sentence_template += "<span style='color:Crimson'><b>Adverbs:</b> </span><br>";
                sentence_template += "<div style='margin-left: 2em;'>";

                for (var i = 0; i < adverbs.length; i++) {
                    var adverb = adverbs[i];
                    wordTemplate = createWordTemplate(adverb);
                    sentence_template += wordTemplate;
                }
                sentence_template += "</div>";
            }


            sentence_template += "<hr>";
            sentenceData += sentence_template;


        }


       
	//html += "<p ><span id='moreInformation' class='more'>More Informatoin</span></p>";
      //  html += "<span class='close' id='" + localid + "'><b> x </b></span>";
	 

        html += sentenceData + "</div>";
	//var element=$(html);
	//console.log(element);
	alert(html);
       $('body' ).append(html);
	

    }


    /**
     *
     * @param {type} word
     * @returns {String}
     */
    function createWordTemplate(word) {
        var fontsize = "'-1'";
        var wordTemplate = "<span style='color:DarkRed  ' <font size=" + fontsize + "> Word : </font></span>" + word.word + " &nbsp;&nbsp;";
        wordTemplate += "<span style='color:DarkBlue  ' <font size=" + fontsize + "> Lemma : </font></span>" + word.lemma + "&nbsp;&nbsp;";
        wordTemplate += "<span style='color:green  ' <font size=" + fontsize + "> POS : </font></span>" + word.pos + "&nbsp;&nbsp;"
        wordTemplate += "<span style='color:FireBrick  ' <font size=" + fontsize + "> Definition : </font></span>" + word.definition + " &nbsp;&nbsp;";
        wordTemplate += "<br>";

        return wordTemplate;
    }
